(function(e){function i(e){return n[e.replace(/^\.\//,"")]}function s(e){if(t[e]!==!0)return;n[e]=n[e](),t[e]=!0}function o(e,t,o){r=e,o=o||t;var u={exports:{}};t instanceof Array&&t.map(s);var a=o(i,u.exports,u);n[e]=a||u.exports}var t={},n={},r;o("base",["require","exports","module"],function(e,t,n){function i(e){return typeof e=="function"}function s(e,t){return f(t)&&(t=t.promise),a(t)?(t.then(e.resolve.bind("resolve"),e.reject.bind("reject")),e.promise):e.resolve(t)}function o(e,t){return function(n){try{s(e,t(n))}catch(r){e.reject(r)}}}function u(e,t){return Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r)}),e}function a(e){return!!e&&typeof e.then=="function"}function f(e){return!!e&&a(e.promise)}function l(e,t,n){var r,i;return f(e)?i=e.promise:a(e)?i=e:(r=this(),r.resolve(e),i=r.promise),i.then(t,n)}function c(e,t){function n(){this.init()}function r(){this.promise=new n,this.init()}function i(){return new r}return n.prototype=Object.create(this.proto.promise),e&&u(n.prototype,e),r.prototype=Object.create(this.proto.deferred),t&&u(r.prototype,t),u(i,this),i.proto={deferred:r.prototype,promise:n.prototype},n.prototype._factory=i,r.prototype._factory=i,i}var r=function(e,t){setTimeout(e,0,t)},h=c.call({proto:{promise:Object.prototype,deferred:Object.prototype},extend:c,isDeferred:f,isPromise:a,when:l},{init:function(){this.status="unfulfilled",this._cbk={resolve:[],reject:[]}},then:function(e,t){var n=this._factory();return this._cbk.resolve.push(i(e)?o(n,e):n.resolve),this._cbk.reject.push(i(t)?o(n,t):n.reject),n.promise}},{get status(){return this.promise.status},init:function(){this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this)},_complete:function(e,t){if(this.promise.status!=="unfulfilled")return;var n=this._factory,s=e==="resolve";this.promise.status=s?"fulfilled":"failed",this.promise._cbk[e].forEach(function(e){e(t)}),this.promise.then=function(u,a){var f=n(),l=s?u:a;return i(l)?r(o(f,l),t):r(f[e],t),f.promise}},resolve:function(e){this._complete("resolve",e)},reject:function(e){this._complete("reject",e)}});n.exports=h}),o("simple",["require","exports","module","./base"],function(e,t,n){var r=e("./base"),i=r.extend({isResolved:function(){return this.status==="fulfilled"},isRejected:function(){return this.status==="failed"},isCompleted:function(){return this.status!=="unfulfilled"},fin:function(e){function n(n){var r=e();return t.isPromise(r)?r.then(n):n()}var t=this._factory;return this.then(function(e){return n(function(){return e})},function(e){return n(function(){throw e})})}});i.resolved=function(e){var t=this();return t.resolve(e),t.promise},i.rejected=function(e){var t=this();return t.reject(e),t.promise},i.all=function(e){e instanceof Array||(e=Array.prototype.slice.call(arguments));if(!e.length)return this.resolved([]);var t=this(),n=[],r=e.map(this.when.bind(this));return r.forEach(function(e,i){e.then(function(e){n[i]=e,r.every(function(e){return e.isResolved()})&&t.resolve(n)},t.reject)}),t.promise},n.exports=i}),o("cps",["require","exports","module","./simple"],function(e,t,n){var r=e("./simple"),i=r.extend({adapt:function(){var e=this._factory;return this.then(function(t){return e.adapt(t)})}},{callback:function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(n)}}}),s=Function.prototype.call.bind([].slice);i.adapt=function(e){var t=this,n={};return Object.keys(e).forEach(function(r){var i=e[r],o=Object.getOwnPropertyDescriptor(e,r);if(typeof i!="function")return Object.defineProperty(n,r,o);n[r]=function(){var r=t(),o=s(arguments);return i.apply(e,o.concat(r.callback())),r.promise}}),n},n.exports=i}),e.deferred=i(r)})(this);